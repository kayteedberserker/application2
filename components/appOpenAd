import { AppOpenAd, AdEventType, TestIds } from 'react-native-google-mobile-ads';

// Production ID
const adUnitId = __DEV__ ? TestIds.APP_OPEN : 'ca-app-pub-8321404113735166/3815337265';

let appOpenAd = null;
let isAdLoaded = false;

/**
 * Preloads the App Open Ad
 */
export const loadAppOpenAd = () => {
    if (appOpenAd) return; // Already exists

    appOpenAd = AppOpenAd.createForAdRequest(adUnitId, {
        requestNonPersonalizedAdsOnly: true,
        keywords: ['fashion', 'news', 'blog'],
    });

    appOpenAd.addAdEventListener(AdEventType.LOADED, () => {
        isAdLoaded = true;
        console.log("App Open Ad Loaded");
    });

    appOpenAd.addAdEventListener(AdEventType.CLOSED, () => {
        isAdLoaded = false;
        appOpenAd = null;
        // Reload for next time
        loadAppOpenAd();
    });

    appOpenAd.addAdEventListener(AdEventType.ERROR, (error) => {
        console.error("App Open Ad Error:", error);
        appOpenAd = null;
    });

    appOpenAd.load();
};

/**
 * Shows the Ad if it is ready
 */
export const showAppOpenAd = () => {
    if (isAdLoaded && appOpenAd) {
        appOpenAd.show();
    } else {
        console.log("Ad not ready yet, skipping.");
        loadAppOpenAd(); // Try to load it for later
    }
};

// Also providing a default export to prevent import errors if used elsewhere
export default { loadAppOpenAd, showAppOpenAd };

